plugins {
//  id 'com.palantir.graal'
  id 'org.springframework.boot'
  id 'com.github.johnrengelman.shadow'
//  id 'org.springframework.experimental.aot'
}

dependencies {
  implementation 'org.springframework.boot:spring-boot-starter'

  implementation("de.m4rc3l.nova:nova-core:${novaVersion}") { changing true }

  runtimeOnly project(':luna-cacti')
  runtimeOnly project(':luna-dvb')
  runtimeOnly project(':luna-weather')

  runtimeOnly 'org.postgresql:postgresql'
//   runtimeOnly 'org.liquibase:liquibase-core'

  annotationProcessor "com.github.therapi:therapi-runtime-javadoc-scribe:${therapiRuntimeJavadocVersion}"
  implementation "org.springdoc:springdoc-openapi-webflux-ui:${springDocVersion}"
//  implementation "org.springdoc:springdoc-openapi-native:${springDocVersion}"
  implementation "org.springdoc:springdoc-openapi-javadoc:${springDocVersion}"
  implementation 'org.springframework.boot:spring-boot-starter-actuator'

  implementation platform('io.sentry:sentry-bom:6.9.2')
  implementation 'io.sentry:sentry-spring-boot-starter'
  implementation 'io.sentry:sentry-logback'

//  runtimeOnly 'io.netty.incubator:netty-incubator-transport-native-io_uring:0.0.8.Final:linux-x86_64'
//  runtimeOnly 'io.netty:netty-tcnative-boringssl-static'

  developmentOnly 'org.springframework.boot:spring-boot-devtools'
  annotationProcessor 'org.springframework.boot:spring-boot-configuration-processor'
  annotationProcessor 'org.springframework:spring-context-indexer'
  // testImplementation 'org.springframework.boot:spring-boot-starter-test'
  // testImplementation 'io.projectreactor:reactor-test'
}

springBoot {
  buildInfo()
}

bootBuildImage {
  builder = 'paketobuildpacks/builder:tiny'
  environment = ['BP_NATIVE_IMAGE': 'true']
}

//shadowJar {
//  mergeServiceFiles()
//}

//def p = new Properties()
//file('build/resources/aot/META-INF/native-image/org.springframework.aot/spring-aot/native-image.properties').withInputStream {
//  p.load(it)
//}
//
//def args = p.Args.split(' ');
//for (String s : args) {
//  println("option '${s}'")
//}

//println(Arrays.toString(args))

//graal {
//  javaVersion '11'
//  outputName 'luna'
//  mainClass 'de.m4rc3l.luna.Bootstrap'
////  mainClass 'org.springframework.boot.loader.JarLauncher'
//
//  option '-H:+StaticExecutableWithDynamicLibC'
//  option '--allow-incomplete-classpath'
//  option '--report-unsupported-elements-at-runtime'
//  option '--no-fallback'
//  option '--no-server'
//  option '--install-exit-handlers'
////  option '-H:+InlineBeforeAnalysis'
//  option '--initialize-at-build-time=com.fasterxml.jackson.databind.ext.Java7Handlers,com.fasterxml.jackson.databind.ext.Java7HandlersImpl,com.fasterxml.jackson.databind.ext.Java7Support,com.fasterxml.jackson.databind.ext.Java7SupportImpl,com.fasterxml.jackson.databind.util.ClassUtil,javax.persistence.FetchType,javax.persistence.PersistenceContextType,javax.persistence.SynchronizationType,org.aopalliance.aop.Advice,org.apache.commons.logging.LogAdapter,org.apache.commons.logging.LogAdapter$1,org.apache.commons.logging.LogAdapter$Log4jLog,org.apache.commons.logging.LogAdapter$Slf4jLocationAwareLog,org.apache.commons.logging.LogFactory,org.hibernate.EntityMode,org.hibernate.validator.internal.engine.ConfigurationImpl,org.hibernate.validator.internal.engine.ValidatorFactoryImpl,org.hibernate.validator.internal.engine.ValidatorImpl,org.hibernate.validator.internal.engine.groups.ValidationOrderGenerator,org.hibernate.validator.internal.engine.resolver.TraversableResolvers,org.hibernate.validator.internal.engine.scripting.DefaultScriptEvaluatorFactory,org.hibernate.validator.internal.util.CollectionHelper,org.hibernate.validator.internal.util.Contracts,org.hibernate.validator.internal.util.logging.Log,org.hibernate.validator.internal.util.logging.Log_$logger,org.hibernate.validator.internal.util.logging.Messages,org.hibernate.validator.internal.util.logging.Messages_$bundle,org.hibernate.validator.internal.util.privilegedactions.GetMethod,org.hibernate.validator.internal.util.privilegedactions.LoadClass,org.hibernate.validator.internal.xml.config.ResourceLoaderHelper,org.hibernate.validator.internal.xml.config.ValidationBootstrapParameters,org.hibernate.validator.internal.xml.config.ValidationXmlParser,org.hibernate.validator.messageinterpolation.AbstractMessageInterpolator,org.hibernate.validator.messageinterpolation.ParameterMessageInterpolator,org.hibernate.validator.resourceloading.PlatformResourceBundleLocator,org.hibernate.validator.resourceloading.PlatformResourceBundleLocator$AggregateResourceBundle,org.hibernate.validator.resourceloading.PlatformResourceBundleLocator$AggregateResourceBundleControl,org.slf4j.Logger,org.slf4j.LoggerFactory,org.slf4j.MDC,org.slf4j.event.EventRecodingLogger,org.slf4j.event.SubstituteLoggingEvent,org.slf4j.helpers.FormattingTuple,org.slf4j.helpers.MessageFormatter,org.slf4j.helpers.NOPLogger,org.slf4j.helpers.NOPLoggerFactory,org.slf4j.helpers.SubstituteLogger,org.slf4j.helpers.SubstituteLoggerFactory,org.slf4j.helpers.Util,org.slf4j.impl.StaticLoggerBinder,org.slf4j.spi.LocationAwareLogger,org.springframework.aop.Advisor,org.springframework.aop.Advisor$1,org.springframework.aop.TargetSource,org.springframework.aop.framework.Advised,org.springframework.aot.StaticSpringFactories,org.springframework.beans.CachedIntrospectionResults,org.springframework.beans.PropertyEditorRegistrySupport,org.springframework.beans.factory.xml.XmlBeanDefinitionReader,org.springframework.boot.BeanDefinitionLoader,org.springframework.boot.autoconfigure.cache.CacheConfigurations,org.springframework.boot.liquibase.LiquibaseServiceLocatorApplicationListener,org.springframework.boot.logging.LoggingSystem,org.springframework.boot.logging.java.JavaLoggingSystem$Factory,org.springframework.boot.logging.log4j2.Log4J2LoggingSystem$Factory,org.springframework.boot.logging.logback.LogbackLoggingSystem,org.springframework.boot.logging.logback.LogbackLoggingSystem$Factory,org.springframework.boot.validation.MessageInterpolatorFactory,org.springframework.context.annotation.CommonAnnotationBeanPostProcessor,org.springframework.context.event.EventListenerMethodProcessor,org.springframework.context.support.AbstractApplicationContext,org.springframework.core.DecoratingProxy,org.springframework.core.DefaultParameterNameDiscoverer,org.springframework.core.KotlinDetector,org.springframework.core.NativeDetector,org.springframework.core.ReactiveAdapterRegistry,org.springframework.core.ResolvableType,org.springframework.core.SpringProperties,org.springframework.core.annotation.AnnotationFilter,org.springframework.core.annotation.AnnotationFilter$1,org.springframework.core.annotation.AnnotationFilter$2,org.springframework.core.annotation.AnnotationUtils,org.springframework.core.annotation.PackagesAnnotationFilter,org.springframework.core.annotation.TypeMappedAnnotations,org.springframework.core.io.support.PropertiesLoaderUtils,org.springframework.core.io.support.ResourcePropertiesPersister,org.springframework.core.io.support.SpringFactoriesLoader,org.springframework.data.mapping.context.AbstractMappingContext,org.springframework.format.annotation.DateTimeFormat$ISO,org.springframework.http.HttpStatus,org.springframework.http.MediaType,org.springframework.http.codec.CodecConfigurerFactory,org.springframework.http.codec.support.BaseDefaultCodecs,org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter,org.springframework.http.converter.support.AllEncompassingFormHttpMessageConverter,org.springframework.jdbc.datasource.ConnectionProxy,org.springframework.jdbc.support.JdbcAccessor,org.springframework.jdbc.support.JdbcTransactionManager,org.springframework.nativex.substitutions.boot.NativeSpringBootVersion,org.springframework.transaction.annotation.Isolation,org.springframework.transaction.annotation.Propagation,org.springframework.util.Assert,org.springframework.util.ClassUtils,org.springframework.util.CollectionUtils,org.springframework.util.ConcurrentReferenceHashMap,org.springframework.util.DefaultPropertiesPersister,org.springframework.util.LinkedCaseInsensitiveMap,org.springframework.util.MimeType,org.springframework.util.ReflectionUtils,org.springframework.util.StringUtils,org.springframework.util.unit.DataSize,org.springframework.util.unit.DataUnit,org.springframework.web.client.RestTemplate,ch.qos.logback.classic,ch.qos.logback.classic.util,ch.qos.logback.core,org.apache.logging.log4j,org.apache.logging.slf4j,org.hibernate.validator.constraints,org.hibernate.validator.internal.cfg.context,org.hibernate.validator.internal.engine,org.hibernate.validator.internal.engine.constraintvalidation,org.hibernate.validator.internal.engine.groups,org.hibernate.validator.internal.engine.valueextraction,org.hibernate.validator.internal.metadata.aggregated,org.hibernate.validator.internal.metadata.aggregated.rule,org.hibernate.validator.internal.metadata.core,org.hibernate.validator.internal.metadata.provider,org.hibernate.validator.internal.metadata.raw,org.hibernate.validator.internal.util,org.jboss.logging,org.springframework.core.env'
//  option '--initialize-at-run-time=io.netty.channel.DefaultChannelId,io.netty.channel.unix.Errors,io.netty.channel.unix.IovArray,io.netty.channel.unix.Limits,io.netty.channel.unix.Socket,io.netty.handler.codec.http.websocketx.extensions.compression.DeflateDecoder,io.netty.handler.codec.http2.CleartextHttp2ServerUpgradeHandler,io.netty.handler.codec.http2.Http2ConnectionHandler,io.netty.handler.codec.http2.Http2ServerUpgradeCodec,io.netty.resolver.HostsFileEntriesResolver,io.netty.channel.epoll'
//}
